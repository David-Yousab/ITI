---
- name: Install and start Apache (httpd) on Amazon Linux
  hosts: all  # Targets all hosts in inventory
  become: yes  # Run tasks with sudo/root privileges

  tasks:
    - name: Install httpd package (Amazon Linux uses yum)
      ansible.builtin.yum:
        name: httpd
        state: present

    - name: Start and enable httpd service
      ansible.builtin.service:
        name: httpd
        state: started
        enabled: yes

    - name: Ensure default HTTP port (80) is open in the firewall
      ansible.builtin.firewalld:
        service: http
        state: enabled
        permanent: yes
        immediate: yes
      when: "'firewalld' in ansible_facts.services"  # Only if firewalld is installed
